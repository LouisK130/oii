<resolvers>
  <resolver name="all_series">
    <var name="ignore">
      <value>mvco,MVCO</value>
      <value>Healy1101,Healy 1101</value>
      <value>saltpond,Salt Pond</value>
    </var>
    <match var="ignore" pattern="([^,]*),(.*)" groups="time_series name">
      <hit/>
    </match>
  </resolver>
  <resolver name="time_series">
    <var name="base_url">http://demi.whoi.edu/</var>
    <var name="namespace">${base_url}${time_series}/</var>
    <var name="bot_name">&lt;a href="/about"&gt;Imaging FlowCytobot&lt;a&gt;</var>
    <match var="time_series" pattern="^mvco$">
      <var name="title">${bot_name} @ &lt;a href="http://www.whoi.edu/mvco/"&gt;MVCO&lt;a&gt; 2006-present</var>
      <var name="dbname">ifcb</var>
      <hit/>
    </match>
    <match var="time_series" pattern="^Healy1101$">
      <var name="title">${bot_name} @ &lt;a href="http://www.espo.nasa.gov/icescape/"&gt;ICESCAPE-Healy1101&lt;a&gt;</var>
      <var name="dbname">healy1101</var>
      <hit/>
    </match>
    <match var="time_series" pattern="^saltpond$">
      <var name="title">${bot_name} @ Salt Pond</var>
      <var name="dbname">saltpond</var>
      <hit/>
    </match>
  </resolver>
  <resolver name="pid">
    <match var="pid" groups="namespace time_series lid bin_lid instrument date year day time - target - product - extension"
	   pattern="(.*?\b(\w+)?)/?(((IFCB\d+)_((\d{4})_(\d{3})_(\d{6})))(_(\d{5}))?)(_([a-zA-Z]\w+))?(\.([a-z][a-z0-9]*))?">
      <import name="time_series"/>
      <var name="date_format">%Y_%j_%H%M%S</var>
      <var name="schema_version">v1</var>
      <var name="bin_pid">${namespace}${bin_lid}</var>
      <hit/>
    </match>
    <match var="pid" groups="namespace time_series lid bin_lid date year day time instrument - target - product - extension"
	   pattern="(.*?\b(\w+)?)/?((D((\d{4})(\d{4})T(\d{6}))_(IFCB\d+))(_(\d{5}))?)(_(\w+))?(\.(\w+))?">
      <import name="time_series"/>
      <var name="date_format">%Y%m%dT%H%M%S</var>
      <var name="schema_version">v2</var>
      <var name="bin_pid">${namespace}${bin_lid}</var>
      <hit/>
    </match>
  </resolver>
  <resolver name="data_roots">
    <match var="time_series" pattern="^mvco$">
      <var name="root">
	<value>/data/vol3/adcmod</value> <!-- look here first, it shadows unmodified adc data -->
	<value>/data/vol3</value>
	<value>/data/vol1</value>
	<value>/data/vol2</value>
      </var>
      <hit/>
    </match>
    <match var="time_series" pattern="^Healy1101$">
      <var name="root">
	<value>/mnt/healy1101/data</value>
      </var>
      <hit/>
    </match>
    <match var="time_series" pattern="^saltpond$">
      <var name="root">
	<value>/mnt/saltpond</value>
      </var>
      <hit/>
    </match>
  </resolver>
  <resolver name="binpid2path">
    <!-- pid = pid of sample bin; format = adc,roi, or hdr -->
    <import name="pid"/>
    <import name="data_roots"/>
    <var name="filename">
      <value>${lid}.${format}</value>
      <value>${lid}.${format}.mod</value>
    </var>
    <any>
      <path match="${root}/${instrument}_${year}_${day}/${filename}"/>
      <!-- in some cases there aren't year/day directories -->
      <path match="${root}/${filename}"/>
      <!-- try v2 patterns -->
      <path match="${root}/D${year}/D${year}${day}/${filename}"/>
    </any>
  </resolver>
  <resolver name="blob_roots">
    <match var="time_series" pattern="^mvco$">
      <var name="root">/data/vol4/blobs</var>
      <hit/>
    </match>
    <match var="time_series" pattern="^Healy1101$">
      <var name="root">/mnt/healy1101/blobs</var>
      <hit/>
    </match>
    <match var="time_series" pattern="^saltpond$">
      <var name="root">/data/vol4/blobs/saltpond</var>
      <hit/>
    </match>
  </resolver>
  <resolver name="mvco_blob">
    <import name="pid"/>
    <import name="blob_roots"/>
    <var name="filename">${bin_lid}_blobs_v2.zip</var>
    <any>
      <path match="${root}/${year}/${year}_${day}/${filename}"/> <!-- v1-style -->
      <path match="${root}/${year}/${year}${day}/${filename}"/> <!-- v2-style -->
    </any>
  </resolver>
  <resolver name="list_adcs">
    <!-- list all adc files. -->
    <import name="data_roots"/>
    <path var="day_dir" match="${root}/IFCB*">
      <path var="adc_file" match="IFCB*.adc">
	<!-- find the adc file -->
	<match var="adc_file" groups="pid">.*(IFCB.*)\..*</match>
	<!-- now resolve all three files separately as they may not be co-located -->
	<var name="format">
	  <value>adc</value>
	  <value>roi</value>
	  <value>hdr</value>
	</var>
	<!-- resolve using pid and format -->
	<import name="binpid2path"/>
	<hit>${day_dir}/${filename}</hit>
      </path>
    </path>
  </resolver>
</resolvers>