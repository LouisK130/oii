<resolvers>
  <resolver name="pid">
    <match var="pid" groups="namespace time_series lid bin_lid instrument date year day time - target - product - extension"
	   pattern="(.*?\b([a-zA-Z0-9_]+)?)/?(((IFCB\d+)_((\d{4})_(\d{3})_(\d{6})))(_(\d{5}))?)(_([a-zA-Z]\w+))?(\.([a-z][a-z0-9]*))?">
      <var name="base_url">http://demi.whoi.edu:5062/</var>
      <var name="namespace">${base_url}${time_series}/</var>
      <var name="date_format">%Y_%j_%H%M%S</var>
      <var name="schema_version">v1</var>
      <var name="bin_pid">${namespace}${bin_lid}</var>
      <hit/>
    </match>
  </resolver>
  <resolver name="data_roots">
    <var name="root">
      <value>/data/vol3/adcmod</value> <!-- look here first, it shadows unmodified adc data -->
      <value>/data/vol3</value>
      <value>/data/vol1</value>
      <value>/data/vol2</value>
    </var>
    <hit/>
  </resolver>
  <resolver name="binpid2path">
    <!-- pid = pid of sample bin; format = adc,roi, or hdr -->
    <import name="pid"/>
    <import name="data_roots"/>
    <var name="filename">
      <value>${lid}.${format}</value>
      <value>${lid}.${format}.mod</value>
    </var>
    <path match="${root}/${instrument}_${year}_${day}/${filename}"/>
  </resolver>
  <resolver name="mvco_blob">
    <import name="pid"/>
    <var name="filename">${bin_lid}_blobs_v2.zip</var>
    <var name="root">
      <value>/data/vol4/blobs</value>
    </var>
    <path match="${root}/${year}/${year}_${day}/${filename}"/>
  </resolver>
  <resolver name="list_adcs">
    <!-- list all adc files. -->
    <import name="data_roots"/>
    <path var="day_dir" match="${root}/IFCB*">
      <path var="adc_file" match="IFCB*.adc">
	<!-- find the adc file -->
	<match var="adc_file" groups="pid">.*(IFCB.*)\..*</match>
	<!-- now resolve all three files separately as they may not be co-located -->
	<var name="format">
	  <value>adc</value>
	  <value>roi</value>
	  <value>hdr</value>
	</var>
	<!-- resolve using pid and format -->
	<import name="binpid2path"/>
	<hit>${day_dir}/${filename}</hit>
      </path>
    </path>
  </resolver>
</resolvers>